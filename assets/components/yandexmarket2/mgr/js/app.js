(function(e){function t(t){for(var n,r,l=t[0],o=t[1],c=t[2],u=0,p=[];u<l.length;u++)r=l[u],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&p.push(a[r][0]),a[r]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);d&&d(t);while(p.length)p.shift()();return s.push.apply(s,c||[]),i()}function i(){for(var e,t=0;t<s.length;t++){for(var i=s[t],n=!0,l=1;l<i.length;l++){var o=i[l];0!==a[o]&&(n=!1)}n&&(s.splice(t--,1),e=r(r.s=i[0]))}return e}var n={},a={app:0},s=[];function r(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=n,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/YandexMarket2/assets/components/yandexmarket2/mgr/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],o=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var d=o;s.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"0e24":function(e,t,i){},"12e0":function(e,t,i){"use strict";i("e393")},"14ee":function(e,t,i){"use strict";i("4e5a")},1688:function(e,t,i){"use strict";i("0e24")},"1b72":function(e,t,i){"use strict";i("b386")},"1fec":function(e,t,i){},2550:function(e,t,i){"use strict";i("f1d2")},"265a":function(e,t,i){},"288e":function(e,t,i){"use strict";i("9356")},"3d57":function(e,t,i){},"3d82":function(e,t,i){"use strict";i("3d57")},"4e5a":function(e,t,i){},"56d7":function(e,t,i){"use strict";i.r(t);i("b64b"),i("4d63"),i("ac1f"),i("25f0"),i("5319"),i("e260"),i("e6cf"),i("cca6"),i("a79d");var n=i("2b0e"),a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.$isMODX3?"modx3":"modx2",attrs:{id:"yandexmarket-app","data-vuetify":""}},[i("v-app",{staticStyle:{background:"transparent"}},[i("router-view")],1)],1)},s=[],r={name:"yandexmarket-app",created:function(){this.$store.dispatch("marketplace/loadList"),this.$store.dispatch("loadClassKeys"),this.$store.dispatch("field/loadListTypes")}},l=r,o=(i("14ee"),i("2877")),c=i("6544"),d=i.n(c),u=i("7496"),p=Object(o["a"])(l,a,s,!1,null,"2f2eb263",null),f=p.exports;d()(p,{VApp:u["a"]});var h=i("f309"),v=(i("84d5"),{complete:"icon icon-check",cancel:"icon icon-times-circle",close:"icon icon-times",delete:"icon icon-times-circle",clear:"icon icon-times-circle",success:"icon icon-check-circle",info:"icon icon-info-circle",warning:"icon icon-exclamation",error:"icon icon-exclamation-triangle",prev:"icon icon-chevron-left",next:"icon icon-chevron-right",checkboxOn:"icon icon-check-square",checkboxOff:"icon icon-square-o",checkboxIndeterminate:"icon icon-minus-square",delimiter:"icon icon-circle",sort:"icon icon-sort-up",expand:"icon icon-chevron-down",menu:"icon icon-bars",subgroup:"icon icon-caret-down",dropdown:"icon icon-caret-down",radioOn:"icon icon-dot-circle-o",radioOff:"icon icon-circle-o",edit:"icon icon-pencil",ratingEmpty:"icon icon-star-o",ratingFull:"icon icon-star",ratingHalf:"icon icon-star-half-o",loading:"icon icon-refresh",first:"icon icon-step-backward",last:"icon icon-step-forward",unfold:"icon icon-angle-double-down",file:"icon icon-paperclip",plus:"icon icon-plus",minus:"icon icon-minus"}),m=i("5607");n["a"].use(h["a"],{directives:{Ripple:m["a"]}});var b=new h["a"]({icons:{values:v},theme:{themes:{light:{primary:"#3697cd",accent:"#3697cd",secondary:"#32AB9A"}}}}),g=i("bc3a"),y=i.n(g),_=i("8c4f"),x=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-card",{staticClass:"ym2-main-wrapper"},[i("v-card-title",[e.total?[e._v(e._s(e.$t("You have {total} {pricelists}",{total:e.total,pricelists:e.decl(e.total,e.$t("pricelist|pricelists|pricelists").split("|"),!1)}))+" ")]:[e._v(e._s(e.$t("Add your first pricelist")))],i("v-spacer"),i("v-dialog",{attrs:{"max-width":"400px"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,a=t.attrs;return[i("v-btn",e._g(e._b({attrs:{color:"secondary",disabled:e.loading,small:""}},"v-btn",a,!1),n),[i("v-icon",{staticClass:"icon-sm",attrs:{left:""}},[e._v("icon icon-plus")]),e._v(" "+e._s(e.$t("Add pricelist"))+" ")],1)]}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[e._v(e._s(e.$t("Adding a pricelist")))])]),i("v-card-text",{staticClass:"pb-1"},[i("v-select",{staticClass:"mb-5",attrs:{hint:e.$t("You can add new ones, see documentation"),"persistent-hint":"",items:e.marketplaces,error:!!e.errors["type"],"error-messages":e.errors["type"],label:e.$t("Marketplace"),"menu-props":{offsetY:!0},attach:!0},model:{value:e.pricelist.type,callback:function(t){e.$set(e.pricelist,"type",t)},expression:"pricelist.type"}}),i("v-text-field",{attrs:{error:!!e.errors["name"],"error-messages":e.errors["name"],label:e.$t("Pricelist name")},model:{value:e.pricelist.name,callback:function(t){e.$set(e.pricelist,"name",t)},expression:"pricelist.name"}}),i("v-text-field",{attrs:{error:!!e.errors["file"],"error-messages":e.errors["file"],label:e.$t("Pricelist filename")},model:{value:e.pricelist.file,callback:function(t){e.$set(e.pricelist,"file",t)},expression:"pricelist.file"}})],1),i("v-card-actions",{staticClass:"pb-4"},[i("v-btn",{attrs:{text:""},on:{click:e.closeDialog}},[e._v(" "+e._s(e.$t("Cancel"))+" ")]),i("v-spacer"),i("v-btn",{attrs:{color:"secondary"},on:{click:e.createPricelist}},[e._v(" "+e._s(e.$t("Add"))+" ")])],1)],1)],1)],2),i("v-data-table",{staticClass:"pricelists-table",attrs:{items:e.lists,"header-props":{sortByText:e.$t("Sort by")},headers:e.headers,options:e.options,"server-items-length":e.total,loading:e.loading,"no-data-text":e.$t("No pricelists yet"),"footer-props":{itemsPerPageText:e.$t("Show by"),itemsPerPageOptions:[20,50,100],showCurrentPage:!0,showFirstLastPage:!0}},on:{"update:options":function(t){e.options=t}},scopedSlots:e._u([{key:"footer.page-text",fn:function(t){var n=t.pageStart,a=t.pageStop,s=t.itemsLength;return[i("span",[e._v(e._s(e.$t("Displaying {pageStart}-{pageStop} of {itemsLength}",{pageStart:n,pageStop:a,itemsLength:s})))]),i("v-btn",{staticClass:"ml-6 mr-n5",attrs:{icon:"",title:e.$t("refresh")},on:{click:e.loadLists}},[i("v-icon",[e._v("icon icon-refresh")])],1)]}},{key:"item.active",fn:function(t){var i=t.value;return[e._v(" "+e._s(i?e.$t("Yes"):e.$t("No"))+" ")]}},{key:"item.generated_on",fn:function(t){var i=t.value;return[e._v(" "+e._s(i||e.$t("File not generated yet"))+" ")]}},{key:"item.generate_mode",fn:function(t){var i=t.value;return[2===parseInt(i)?[e._v(" "+e._s(e.$t("Cron only"))+" ")]:1===parseInt(i)?[e._v(" "+e._s(e.$t("On the fly"))+" ")]:[e._v(" "+e._s(e.$t("Manually"))+" ")]]}},{key:"item.type",fn:function(t){var i=t.value;return[e._v(" "+e._s(e.marketplaceText(i)||i)+" ")]}},{key:"item.actions",fn:function(t){var n=t.item;return[i("v-spacer"),i("v-btn",{attrs:{to:{name:"pricelist.generate",params:{id:n.id}},title:n.need_generate?e.$t("Need to generate the file!"):e.$t("File generation"),color:n.need_generate?"warning":"inherit",icon:""}},[i("v-icon",[e._v("icon icon-print")])],1),i("v-btn",{attrs:{to:{name:"pricelist",params:{id:n.id}},title:e.$t("Edit pricelist"),icon:""}},[i("v-icon",[e._v("icon icon-pencil")])],1),i("v-btn",{attrs:{title:e.$t("Delete pricelist"),icon:""},on:{click:function(t){return e.removePricelist(n)}}},[i("v-icon",[e._v("icon icon-trash")])],1)]}}])})],1)},C=[],$=(i("d81d"),i("fb6a"),i("4ec9"),i("4fad"),i("c1f9"),i("d3b7"),i("3ca3"),i("ddb0"),i("5530")),k=(i("99af"),i("4160"),i("159b"),i("53ca")),w=i("d4ec"),O=i("bee2"),j=i("262e"),T=i("2caf"),V=i("9072"),S=function(e){Object(j["a"])(i,e);var t=Object(T["a"])(i);function i(e){var n;return Object(w["a"])(this,i),n=t.call(this,e&&e.message||"Ошибка"),n.response=e,n}return Object(O["a"])(i,[{key:"getMessage",value:function(){return this.message}}]),i}(Object(V["a"])(Error)),P=function(e){Object(j["a"])(i,e);var t=Object(T["a"])(i);function i(){return Object(w["a"])(this,i),t.apply(this,arguments)}return Object(O["a"])(i,[{key:"getErrors",value:function(){return this.response&&this.response.data||[]}}]),i}(S),F={post:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return y.a.request({method:"POST",data:this.prepareData(t,e)}).then((function(e){if(Object.prototype.hasOwnProperty.call(e.data,"success")&&!e.data.success)throw e.data.data&&e.data.data.length?new P(e.data):new S(e.data);return e}))},prepareData:function(e,t){var i;return"object"!==Object(k["a"])(e)||e instanceof FormData?e instanceof FormData&&(i=e):(i=new FormData,this.buildFormData(i,e)),i.append("action",t),i},buildFormData:function(e,t,i){var n=this;if(!t||"object"!==Object(k["a"])(t)||t instanceof Date||t instanceof File){var a=null==t?"":t;e.append(i,a)}else Object.keys(t).forEach((function(a){n.buildFormData(e,t[a],i?"".concat(i,"[").concat(a,"]"):a)}))}};function A(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[2,0,1,1,1,2],a=t[e%100>4&&e%100<20?2:n[e%10<5?e%10:5]];return i?e+" "+a:a}var L=i("2f62"),E={name:"PriceLists",data:function(){return{defaultItem:{file:"goods.xml",name:this.$t("All goods"),type:"yandex.market"},pricelist:{file:"",name:"",type:""},dialog:!1,loading:!1,lists:[],headers:[{text:this.$t("ID"),value:"id",sortable:!0},{text:this.$t("Name"),value:"name",sortable:!0},{text:this.$t("Pricelist type"),value:"type",sortable:!0},{text:this.$t("Filename"),value:"file",sortable:!0},{text:this.$t("Generation type"),value:"generate_mode",sortable:!0},{text:this.$t("Generated at"),value:"generated_on",sortable:!0},{text:this.$t("Active"),value:"active",sortable:!0},{text:this.$t("Actions"),value:"actions",sortable:!1,align:"end"}],errors:{},total:0,options:{page:1,itemsPerPage:20,sortBy:[],sortDesc:[]}}},computed:Object($["a"])(Object($["a"])({},Object(L["c"])("marketplace",["marketplaces"])),Object(L["b"])("marketplace",["marketplaceText"])),watch:{options:{handler:function(){this.loadLists()},deep:!0,immediate:!0}},methods:{decl:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return A(e,t,i)},loadLists:function(){var e=this;this.loading=!0;var t={start:(this.options.page-1)*this.options.itemsPerPage,limit:this.options.itemsPerPage,sort:this.options.sortBy[0]||"id",dir:Object.prototype.hasOwnProperty.call(this.options.sortDesc,0)?this.options.sortDesc[0]?"desc":"asc":"desc"};F.post("Pricelists/GetList",t).then((function(t){var i=t.data;e.lists=i.results,e.total=i.total})).catch((function(e){return console.error(e)})).then((function(){return e.loading=!1}))},closeDialog:function(){this.errors={},this.dialog=!1,this.pricelist=Object($["a"])({},this.defaultItem)},createPricelist:function(){var e=this;this.errors={},this.loading=!0,F.post("Pricelists/Create",Object($["a"])(Object($["a"])({},this.pricelist),{},{active:!1})).then((function(t){var i=t.data;e.$router.push({name:"pricelist",params:{id:i.object.id}}),e.pricelist=Object($["a"])({},e.defaultItem)})).catch((function(t){if(t instanceof P){var i=new Map(t.getErrors().map((function(e){return Object.entries(e).slice(0,2).map((function(e){return e[1]||""}))})));e.errors=Object.fromEntries(i)}else console.error(t.toString())})).then((function(){e.loading=!1}))},removePricelist:function(e){var t=this;confirm(this.$t("Are you sure you want to remove the pricelist {pricelist}? This action is irreversible",{pricelist:e.id}))&&(this.loading=!0,F.post("Pricelists/Remove",{id:e.id}).then((function(){return t.loadLists()})).catch((function(e){return console.error(e)})).then((function(){return t.loading=!1})))}},mounted:function(){this.pricelist=Object($["a"])({},this.defaultItem)}},I=E,K=(i("288e"),i("8336")),D=i("b0af"),N=i("99d9"),U=i("8fea"),q=i("169a"),X=i("132d"),B=i("b974"),M=i("2fa4"),R=i("8654"),G=Object(o["a"])(I,x,C,!1,null,null,null),Y=G.exports;d()(G,{VBtn:K["a"],VCard:D["a"],VCardActions:N["a"],VCardText:N["b"],VCardTitle:N["c"],VDataTable:U["a"],VDialog:q["a"],VIcon:X["a"],VSelect:B["a"],VSpacer:M["a"],VTextField:R["a"]});var H=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"yandexmarket-pricelist"},[e.id?i("v-tabs",{staticClass:"yandexmarket-pricelist-tabs pr-15",attrs:{"background-color":"transparent",height:40}},[i("v-tab",{attrs:{to:{name:"pricelist",params:{id:e.id}},ripple:!1,exact:""}},[e._v(" "+e._s(e.$t("Shop settings"))+" ")]),i("v-tab",{attrs:{to:{name:"pricelist.categories",params:{id:e.id}},ripple:!1,exact:""}},[e._v(" "+e._s(e.$t("Categories settings"))+" ")]),e.hasOffers?i("v-tab",{attrs:{to:{name:"pricelist.offers",params:{id:e.id}},ripple:!1,exact:""}},[e._v(" "+e._s(e.$t("Offers settings"))+" ")]):e._e(),i("v-tab",{attrs:{to:{name:"pricelist.generate",params:{id:e.id}},ripple:!1,exact:""}},[e._v(" "+e._s(e.$t("File generation and parameters"))+" ")])],1):e._e(),i("v-card",{staticClass:"yandexmarket-pricelist-card",attrs:{loading:!e.pricelist}},[i("v-card-text",{staticStyle:{"min-height":"300px"}},[e.showPreview?i("v-btn",{attrs:{fab:"",absolute:"",top:"",right:"",small:"",elevation:"1",color:"white",title:e.preview?e.$t("Disable preview"):e.$t("Enable preview")},on:{click:e.togglePreview}},[i("v-icon",{attrs:{color:e.preview?"primary":"default"}},[e._v("icon-file-code-o")])],1):e._e(),i("v-row",{attrs:{dense:""}},[i("v-col",{attrs:{md:e.showPreview&&e.preview?7:12}},[e.pricelist?i("router-view",e._b({on:{"preview:xml":e.previewXml,"field:created":function(t){return e.fieldUpdated(t,!0)},"field:updated":e.fieldUpdated,"field:deleted":e.fieldDeleted,"attribute:created":function(t){return e.attributeUpdated(t,!0)},"attribute:updated":e.attributeUpdated,"attribute:deleted":e.attributeDeleted,"condition:created":function(t){return e.conditionUpdated(t,!0)},"condition:updated":e.conditionUpdated,"condition:deleted":e.conditionDeleted,"category:added":e.categoryAdded,"category:removed":e.categoryRemoved,"pricelist:updated":e.pricelistUpdated}},"router-view",{pricelist:e.pricelist},!1)):e._e(),e._e()],1),e.showPreview&&e.preview?i("v-col",{attrs:{cols:"12",md:"5"}},[i("div",{staticClass:"yandexmarket-xml-preview"},[i("h4",[i("label",{attrs:{for:"yandexmarket-preview"}},[e._v(e._s(e.$t("XML element preview"))+" <"+e._s(e.previewType)+">")])]),i("p",{staticClass:"mb-2"},[e._v(e._s(e.$t("Automatically updated on any change")))]),i("codemirror",{attrs:{id:"yandexmarket-preview",options:e.cmOptions},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}})],1),e.debug&&Object.keys(e.debug).length?i("pre",[e._v(e._s(e.debug))]):e._e()]):e._e()],1),i("loader",{attrs:{status:!e.pricelist}})],1)],1)],1)},W=[],J=(i("4de4"),i("7db0"),i("c740"),i("c975"),i("a434"),i("b0c0"),i("15fd")),z=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.status?i("div",{staticClass:"yandexmarket-loader-overlay"},[i("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1):e._e()},Q=[],Z={props:{status:{type:Boolean}}},ee=Z,te=(i("74ae"),i("490a")),ie=Object(o["a"])(ee,z,Q,!1,null,null,null),ne=ie.exports;d()(ie,{VProgressCircular:te["a"]});var ae=i("8f94"),se=(i("a7be"),i("d5e0"),i("f9d4"),i("4168"),i("d7d5"),{name:"PriceList",components:{Loader:ne,codemirror:ae["codemirror"]},data:function(){return{id:null,pricelist:null,type:"yandexmarket",preview:!0,previewLoading:!1,previewType:null,hasChanges:!0,debug:null,code:null,cmOptions:{lineNumbers:!0,mode:"xml",cursorBlinkRate:-1,readOnly:!0}}},computed:{showPreview:function(){return-1!==["pricelist","pricelist.categories","pricelist.offers"].indexOf(this.$route.name)},hasCategories:function(){return this.pricelist&&this.pricelist.fields.find((function(e){return-1!==[4,14].indexOf(e.type)}))},hasOffers:function(){return this.pricelist&&this.pricelist.fields.find((function(e){return-1!==[5,15].indexOf(e.type)}))}},methods:{categoryAdded:function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.pricelist.categories.indexOf(parseInt(e))&&this.pricelist.categories.push(parseInt(e)),i&&(F.post("Categories/Create",{pricelist_id:this.pricelist.id,resource_id:e}).then((function(){return t.getXmlPreview()})).catch((function(i){console.error(i),t.categoryRemoved(e,!1)})),this.pricelistUpdated({need_generate:this.pricelist.need_generate||this.pricelist.active&&this.pricelist.generated_on},!1))},categoryRemoved:function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.pricelist.categories=this.pricelist.categories.filter((function(t){return t!==e})),i&&(F.post("Categories/Remove",{pricelist_id:this.pricelist.id,resource_id:e}).then((function(){return t.getXmlPreview()})).catch((function(e){return console.error(e)})),this.pricelistUpdated({need_generate:this.pricelist.need_generate||this.pricelist.active&&this.pricelist.generated_on},!1))},fieldUpdated:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.pricelist.fields.slice();t?i.push(e):i.splice(i.findIndex((function(t){return t.id?t.id===e.id:t.parent===e.parent})),1,e),e.need_reload?this.loadPricelist():this.pricelistUpdated({fields:i,need_generate:this.pricelist.need_generate||this.pricelist.active&&this.pricelist.generated_on},!1)},fieldDeleted:function(e){var t=this.pricelist.fields.slice();t.splice(t.findIndex((function(t){return t.id===e.id})),1),this.pricelistUpdated({fields:t,need_generate:this.pricelist.need_generate||this.pricelist.active&&this.pricelist.generated_on},!1)},attributeUpdated:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.pricelist.attributes.slice();t?i.push(e):i.splice(i.findIndex((function(t){return t.id?t.id===e.id:t.field_id===e.field_id})),1,e),this.pricelistUpdated({attributes:i,need_generate:this.pricelist.need_generate||this.pricelist.active&&this.pricelist.generated_on},!1)},attributeDeleted:function(e){var t=this.pricelist.attributes.slice();t.splice(t.findIndex((function(t){return t.id===e.id})),1),this.pricelistUpdated({attributes:t,need_generate:this.pricelist.need_generate||this.pricelist.active&&this.pricelist.generated_on},!1)},conditionUpdated:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.pricelist.conditions.slice();t?i.push(e):i.splice(i.findIndex((function(t){return t.id?t.id===e.id:!t.id})),1,e),this.pricelistUpdated({conditions:i,need_generate:this.pricelist.need_generate||this.pricelist.active&&this.pricelist.generated_on},!1)},conditionDeleted:function(e){var t=this.pricelist.conditions.slice();t.splice(t.findIndex((function(t){return t.id===e.id})),1),this.pricelistUpdated({conditions:t,need_generate:this.pricelist.need_generate||this.pricelist.active&&this.pricelist.generated_on},!1)},togglePreview:function(){var e=this;this.preview=!this.preview,this.preview&&this.$nextTick().then((function(){e.getXmlPreview()}))},previewXml:function(e){this.previewType=e,this.preview&&this.getXmlPreview()},getXmlPreview:function(){var e=this;this.previewLoading||(this.previewLoading=!0,this.code="\x3c!-- ".concat(this.$t("Loading an XML element")," ").concat(this.previewType," --\x3e"),F.post("Xml/Preview",{id:this.pricelist.id,method:this.previewType}).then((function(t){var i=t.data;e.code=i.message,e.debug=i.object})).catch((function(e){return console.log(e)})).then((function(){return e.previewLoading=!1})))},loadPricelist:function(){var e=this;F.post("Pricelists/Get",{id:this.id}).then((function(t){var i=t.data;e.pricelist=i.object;var n=e.$route.matched.find((function(e){return e.meta&&e.meta.replaceable}));n&&e.$set(n,"meta",Object($["a"])(Object($["a"])({},n.meta),{},{title:"".concat(i.object.name," (").concat(i.object.id,")")}))})).catch((function(t){console.error(t),setTimeout((function(){return e.$router.push({name:"pricelists"})}),3e3)}))},pricelistUpdated:function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.pricelist=Object($["a"])(Object($["a"])({},this.pricelist),e),i){this.code="\x3c!-- ".concat(this.$t("Loading an XML element")," ").concat(this.previewType," --\x3e");var n=this.pricelist,a=(n.fields,n.categories,n.attributes,n.conditions,Object(J["a"])(n,["fields","categories","attributes","conditions"]));F.post("Pricelists/Update",Object($["a"])({},a)).then((function(e){var i=e.data;t.pricelist=Object($["a"])(Object($["a"])({},t.pricelist),i.object),t.getXmlPreview()})).catch((function(e){return console.error(e)}))}else this.showPreview&&this.getXmlPreview()}},mounted:function(){this.id=parseInt(this.$route.params.id),this.loadPricelist()}}),re=se,le=(i("dd54"),i("62ad")),oe=i("0fd9"),ce=i("71a3"),de=i("fe57"),ue=Object(o["a"])(re,H,W,!1,null,"d450813c",null),pe=ue.exports;d()(ue,{VBtn:K["a"],VCard:D["a"],VCardActions:N["a"],VCardText:N["b"],VCol:le["a"],VIcon:X["a"],VRow:oe["a"],VSpacer:M["a"],VTab:ce["a"],VTabs:de["a"]});var fe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"yandexmarket-pricelist-offers-fields"},[i("v-row",{staticClass:"ma-0"},[i("v-flex",[i("h4",[e._v(e._s(e.$t("The main criteria for generating a request")))]),i("p",{staticClass:"mb-1"},[e._v(e._s(e.$t("When changes are made, an offer preview is updated")))])]),i("v-spacer"),i("v-btn",{attrs:{icon:"",title:e.$t("Change the offer in the preview")},on:{click:e.previewXml}},[i("v-icon",[e._v("icon-refresh")])],1)],1),i("div",{staticClass:"yandexmarket-pricelist-class"},[i("v-text-field",{attrs:{readonly:e.classKeyDisabled,placeholder:e.$t("Class for fetching offers (class_key from resource table)"),hint:e.$t("Be careful with the setting. For simple resources, specify modDocument"),"background-color":e.classKeyDisabled?"grey lighten-3":"grey lighten-5",dense:"",solo:""},scopedSlots:e._u([{key:"prepend-inner",fn:function(){return[i("div",{staticClass:"text-no-wrap mr-1 ml-n1"},[i("v-icon",{staticClass:"mr-1",attrs:{color:"inherit",title:e.$t("Attribute")}},[e._v("icon-tags")]),i("code",{staticClass:"py-1 d-inline-block"},[e._v(e._s(e.$t("Resource class")))])],1)]},proxy:!0},{key:"append",fn:function(){return[e.classKeyDisabled?i("v-btn",{staticClass:"mt-0 mr-n2",attrs:{small:"",icon:"",title:e.$t("Enable class_key editing")},on:{click:function(t){t.stopPropagation(),e.classKeyDisabled=!e.classKeyDisabled}}},[i("v-icon",[e._v("icon-pencil")])],1):[i("v-btn",{staticClass:"mt-0 mr-2",attrs:{small:"",icon:"",color:"orange",title:e.$t("Cancel changes")},on:{click:function(t){return t.stopPropagation(),e.cancelClass(t)}}},[i("v-icon",[e._v("icon-rotate-left")])],1),i("v-btn",{staticClass:"mt-0 mr-n2",attrs:{small:"",icon:"",title:e.$t("Save changes"),disabled:e.classKey===e.pricelist.class,color:"secondary"},on:{click:function(t){return t.stopPropagation(),e.saveClass(t)}}},[i("v-icon",[e._v("icon-save")])],1)]]},proxy:!0}]),model:{value:e.classKey,callback:function(t){e.classKey=t},expression:"classKey"}})],1),i("div",{staticClass:"yandexmarket-pricelist-where mb-5 mt-0"},[i("v-row",{staticClass:"ma-0 align-center"},[i("h4",[e._v(e._s(e.$t("Conditions for goods")))]),i("v-tooltip",{attrs:{bottom:"","max-width":400,"close-delay":200,attach:!0},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[i("v-btn",e._g({staticClass:"ml-1",attrs:{small:"",icon:""}},n),[i("v-icon",[e._v(" icon-question-circle ")])],1)]}}])},[i("div",{staticClass:"text-caption",staticStyle:{"white-space":"pre-line"}},[e._v(e._s(e.$t("All product fields are available, including TV fields, ms2 options."))+" "+e._s(e.$t("The component will automatically join the columns specified."))+" "+e._s(e.$t("If you need to add third-party components - contact support"))+" ")])]),i("v-spacer"),e.editedWhere?[i("v-btn",{staticClass:"ml-1",attrs:{small:"",icon:"",title:e.$t("Cancel changes"),color:"orange darken-1"},on:{click:e.resetWhere}},[i("v-icon",[e._v("icon-rotate-left")])],1),i("v-btn",{staticClass:"ml-2",attrs:{disabled:e.hasErrors,small:"",title:e.$t("Save changes"),color:"secondary",height:"24"},on:{click:e.saveWhere}},[i("v-icon",{attrs:{left:""}},[e._v("icon-save")]),e._v(" "+e._s(e.$t("Save"))+" ")],1)]:e._e()],2),i("pricelist-conditions",e._g({attrs:{conditions:e.pricelist.conditions,pricelist:e.pricelist}},e.$listeners))],1),i("v-row",{staticClass:"ma-0"},[i("v-flex",[i("h4",[e._v(e._s(e.$t("Set up offers fields")))]),i("p",{staticClass:"mb-2"},[e._v(e._s(e.$t("Interactive mode for adding and editing fields")))])]),i("v-spacer")],1),e.offerField?i("v-expansion-panels",{key:"offers",staticClass:"pb-2",attrs:{multiple:""},model:{value:e.openedFields,callback:function(t){e.openedFields=t},expression:"openedFields"}},[i("pricelist-offer-field",e._g({attrs:{item:e.offerField,fields:e.pricelist.fields,attributes:e.pricelist.attributes,lighten:3,"available-fields":e.availableFields("offer",e.pricelist),"available-types":e.availableTypes("offer",e.pricelist)}},e.$listeners))],1):i("v-alert",{attrs:{type:"warning",dense:"",border:"left"}},[e._v(" "+e._s(e.$t('Element with type "offer" not found. The "offers" element may have been removed.'))+" "+e._s(e.$t("Add an offers element or recreate the pricelist."))+" ")])],1)},he=[],ve=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-expansion-panel",{ref:"panel"+e.field.id,staticClass:"yandexmarket-field",attrs:{readonly:e.readonly}},[i("field-header",{attrs:{readonly:e.readonly,field:e.field,item:e.item,color:"grey lighten-"+e.lighten,edit:e.edit,disabledAddAttribute:!!e.attrs.filter((function(e){return!e.id})).length},on:{"attribute:add":e.addAttribute,"edit:toggle":e.toggleEdit,"edit:cancel":e.cancelEdit,"field:deleted":function(t){return e.$emit("field:deleted",t)},"field:updated":e.fieldUpdated}}),i("v-expansion-panel-content",{attrs:{color:"grey lighten-"+e.lighten,eager:""}},[e.edit?i("v-row",{staticClass:"px-0 pb-1 mb-0",attrs:{dense:""}},[i("v-col",{attrs:{cols:"12",md:"6"}},[i("v-combobox",{staticClass:"yandexmarket-field-tag mr-2",attrs:{value:e.field.name,items:e.availableFields,placeholder:"Введите или выберите из списка",attach:!0,"item-value":"value","item-text":"value","hide-details":"",solo:"",dense:""},on:{input:e.changedName},scopedSlots:e._u([{key:"prepend-inner",fn:function(){return[i("div",{staticClass:"text-no-wrap"},[i("code",{staticClass:"mr-2 mt-1 d-inline-block"},[e._v("Элемент:")]),i("v-icon",{staticClass:"mr-1"},[e._v("icon-angle-left")])],1)]},proxy:!0},{key:"append",fn:function(){return[i("v-icon",[e._v("icon-angle-right")])]},proxy:!0},{key:"item",fn:function(t){var n=t.item;return[i("code",[e._v(e._s(n.value))]),n.value!==n.text?i("small",{staticClass:"pl-1 grey--text"},[e._v(e._s(n.text))]):e._e()]}}],null,!1,1073683775)})],1),i("v-col",{attrs:{cols:"12",md:"6"}},[i("v-select",{staticClass:"yandexmarket-field-type",attrs:{items:e.types,"full-width":!1,label:"Тип элемента",placeholder:"Выберите тип","menu-props":{offsetY:!0},attach:!0,_disabled:!(!e.field.type||e.availableType),"hide-details":"",solo:"",dense:""},scopedSlots:e._u([{key:"prepend-inner",fn:function(){return[i("div",{staticClass:"text-no-wrap mr-2"},[i("code",[e._v("Тип:")])])]},proxy:!0}],null,!1,931772273),model:{value:e.field.type,callback:function(t){e.$set(e.field,"type",t)},expression:"field.type"}})],1)],1):e._e(),e.attrs.length?[i("v-row",{staticClass:"mb-1 mt-0",attrs:{dense:""}},e._l(e.attrs,(function(t){return i("field-attribute",e._g({key:t.id,attrs:{attribute:t}},e.$listeners))})),1)]:e._e(),e.isCategories(e.field)?[i("div",{staticClass:"text-body-2"},[e._v("Список категорий выбирается на вкладке "),i("router-link",{attrs:{to:{name:"pricelist.categories",params:this.$route.params}}},[e._v("Категории и условия")])],1)]:e.isOffers(e.field)?[i("div",{staticClass:"text-body-2"},[e._v("Поля товаров настраиваются на вкладке "),i("router-link",{attrs:{to:{name:"pricelist.offers",params:this.$route.params}}},[e._v("Поля предложений")])],1)]:e.isShop(e.field)&&1===e.parent?[i("div",{staticClass:"text-body-2"},[e._v("Поля магазина настраиваются на вкладке "),i("router-link",{attrs:{to:{name:"pricelist",params:this.$route.params}}},[e._v("Настройки магазина")])],1)]:e.isParent(e.field)?i("v-card-text",{staticClass:"pa-0"},[e.children.length?[i("div",{staticClass:"grey--text",staticStyle:{"font-size":"13px"}},[e._v("Дочерние элементы:")]),i("v-expansion-panels",{key:e.field.name,attrs:{value:e.opened,multiple:"",accordion:""}},e._l(e.children,(function(t){return i("pricelist-field",e._g({key:t.id,attrs:{item:t,fields:e.fields,attributes:e.attributes,lighten:e.lighten+1,"available-fields":e.availableFields,"available-types":e.availableTypes,parent:e.field.type}},e.$listeners))})),1)]:e._e(),e.isRoot(e.field)?e._e():i("v-row",{staticClass:"ma-0 align-center"},[e.children.length?e._e():i("div",{staticClass:"grey--text"},[e._v("Ещё нет дочерних элементов")]),i("v-spacer"),i("v-btn",{staticClass:"mt-4",attrs:{small:"",color:"white",disabled:!!e.children.filter((function(e){return!e.id})).length||!e.item.id},on:{click:e.addField}},[i("v-icon",{staticClass:"icon-sm",attrs:{left:""}},[e._v("icon-plus")]),e.children.filter((function(e){return!e.id})).length?[e._v(" Сохраните новое поле ")]:e.item.id?[e._v(" Добавить элемент в <"+e._s(e.field.name)+"> ")]:[e._v(" Сохраните, чтобы добавлять элементы ")]],2)],1)],2):e.isEmptyType(e.field)?e._e():i("field-value",{attrs:{field:e.field},on:{input:function(t){e.field.value=t}}})],2)],1)},me=[],be=(i("a9e3"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-col",{staticClass:"yandexmarket-field-attribute pt-0",attrs:{sm:e.edit?12:6,cols:"12"}},[e.label?i("div",{staticClass:"grey--text",staticStyle:{"font-size":"12px"}},[e._v(e._s(e.label))]):e._e(),e.edit?i("v-sheet",{staticClass:"pt-1 px-2",attrs:{elevation:"1",color:"grey lighten-5"}},[i("v-row",{staticClass:"ma-0"},[e.attribute.id?i("div",[e._v("Редактирование атрибута "+e._s(e.attribute.name))]):i("div",[e._v("Добавление нового атрибута "),i("v-tooltip",{attrs:{bottom:"","max-width":400,"close-delay":200,attach:!0},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[i("v-btn",e._g({staticClass:"mt-n1",attrs:{small:"",icon:""}},n),[i("v-icon",[e._v("icon-question-circle")])],1)]}}])},[i("div",{staticClass:"text-caption",staticStyle:{"white-space":"pre-line"}},[e._v("Описание атрибута можно задать через лексиконы ")])])],1),i("v-spacer"),e.edited?[i("v-btn",{staticClass:"ml-1",attrs:{small:"",icon:"",title:"Отменить изменения",color:"orange darken-1"},on:{click:e.cancelChanges}},[i("v-icon",[e._v("icon-rotate-left")])],1),i("v-btn",{staticClass:"ml-2 mb-1",attrs:{small:"",title:"Сохранить изменения",color:"secondary",height:"26"},on:{click:e.saveChanges}},[i("v-icon",{attrs:{left:""}},[e._v("icon-save")]),e._v(" Сохранить ")],1)]:[e.item.id?i("v-btn",{staticClass:"ml-1",attrs:{small:"",icon:"",title:"Отменить редактирование",color:"secondary"},on:{click:e.editAttr}},[i("v-icon",[e._v("icon-pencil")])],1):e._e(),i("v-btn",{staticClass:"ml-1",attrs:{small:"",icon:"",title:"Удалить поле"},on:{click:e.deleteAttribute}},[i("v-icon",[e._v("icon-trash")])],1)]],2),i("v-row",{staticClass:"mt-1",attrs:{dense:""}},[i("v-col",{attrs:{md:"4"}},[i("v-text-field",{attrs:{label:"Параметр *",placeholder:"латиницей",dense:"",required:""},model:{value:e.item.name,callback:function(t){e.$set(e.item,"name",t)},expression:"item.name"}})],1),i("v-col",{attrs:{md:"4"}},[i("v-select",{attrs:{label:"Тип значения",items:e.items,dense:"","menu-props":{offsetY:!0},attach:!0},model:{value:e.item.type,callback:function(t){e.$set(e.item,"type",t)},expression:"item.type"}})],1),i("v-col",{attrs:{md:"4"}},[i(e.item.values?"v-select":"v-text-field",{tag:"component",attrs:{value:e.item.value,items:e.item.values,label:e.item.values?"Выберите из списка":"Введите значение",placeholder:"Поле товара","hide-details":"",attach:!0,"menu-props":{offsetY:!0},dense:""},on:{input:function(t){e.item.value=t}},scopedSlots:e._u([0!==e.item.type?{key:"append-outer",fn:function(){return[i("v-btn",{staticClass:"px-2 text-center mt-n1",attrs:{title:e.openedCode?"Для закрытия очистите введённый код":"Добавить код-обработчик значения",color:e.openedCode?"secondary":"accent",small:"","min-width":"30"},on:{click:e.toggleCode}},[i("v-icon",[e._v("icon-code")])],1)]},proxy:!0}:null],null,!0)})],1)],1),e.openedCode?i("vue-codemirror",{staticClass:"pb-2 mt-n2",attrs:{options:e.cmOptions,placeholder:"Пример: {$input === 'Да' ? true : false}"},model:{value:e.item.handler,callback:function(t){e.$set(e.item,"handler",t)},expression:"item.handler"}}):e._e()],1):i(e.item.values?"v-select":"v-text-field",{tag:"component",staticClass:"yandexmarket-field-attribute-input",attrs:{items:e.item.values,placeholder:e.item.values?"Выберите из списка":"Введите значение",hint:e.item.handler?"</> "+e.item.handler:null,"persistent-hint":!!e.item.handler,"hide-details":!e.item.handler,attach:!0,"menu-props":{offsetY:!0},dense:"",solo:""},scopedSlots:e._u([{key:"prepend-inner",fn:function(){return[i("div",{staticClass:"text-no-wrap mr-1 ml-n1"},[i("v-icon",{staticClass:"mr-1",attrs:{color:"inherit",title:"Атрибут"}},[e._v("icon-font")]),i("code",{staticStyle:{position:"relative",top:"1px"}},[e._v(e._s(e.item.name))])],1)]},proxy:!0},{key:"append",fn:function(){return[e.edited?i("v-btn",{staticClass:"mt-1",attrs:{small:"",icon:"",title:"Сохранить изменения",color:"secondary"},on:{click:function(t){return t.stopPropagation(),e.saveChanges(t)}}},[i("v-icon",[e._v("icon-save")])],1):i("v-btn",{staticClass:"mt-n1 mr-n2",attrs:{small:"",icon:"",title:"Отредактировать свойства атрибута "+e.item.name},on:{click:function(t){return t.stopPropagation(),e.editAttr(t)}}},[i("v-icon",[e._v("icon-pencil")])],1)]},proxy:!0},e.edited?{key:"append-outer",fn:function(){return[i("v-btn",{staticStyle:{top:"-5px",right:"0"},attrs:{fab:"","x-small":"",absolute:"",depressed:"",width:"24",height:"24",color:"grey lighten-4"}},[i("v-icon",{attrs:{size:"14",title:"Отменить изменения",color:"orange"},on:{click:e.cancelChanges}},[e._v("icon-rotate-left")])],1)]},proxy:!0}:null],null,!0),model:{value:e.item.value,callback:function(t){e.$set(e.item,"value",t)},expression:"item.value"}})],1)}),ge=[],ye=i("2b5d"),_e={name:"FieldAttribute",components:{VSelect:B["a"],VCombobox:ye["a"],VTextField:R["a"],VueCodemirror:ae["codemirror"]},props:{attribute:{required:!0,type:[Object]}},data:function(){return{code:!1,item:{},edit:!1,items:[{value:0,text:"текст (без обработки)"},{value:1,text:"значение из столбца"}],cmOptions:{taSize:4,mode:{name:"smarty",baseMode:"text/html",version:3},line:!0,lineNumbers:!0,lineWrapping:!0}}},watch:{attribute:{immediate:!0,handler:function(e){var t=this;this.item=Object($["a"])(Object($["a"])({},this.item),e),this.$nextTick().then((function(){return t.code=!!t.item.handler}))}}},computed:{edited:function(){return JSON.stringify(this.item)!==JSON.stringify(this.attribute)},label:function(){var e="";return this.item.label&&this.item.label.replace(" *","")!==this.item.name&&(e=this.item.label),e},openedCode:function(){return!!this.item.handler||this.code}},methods:{editAttr:function(){this.edit=!this.edit},saveChanges:function(){var e=this;setTimeout((function(){F.post(e.item.id?"Attributes/Update":"Attributes/Create",e.item).then((function(t){var i=t.data;e.edit=!1,e.$nextTick().then((function(){return e.$emit("attribute:updated",i.object)}))})).catch((function(e){return console.error(e)}))}),10)},cancelChanges:function(){this.item=Object($["a"])(Object($["a"])({},this.item),this.attribute)},deleteAttribute:function(){var e=this;this.item.id?confirm("Вы действительно хотите удалить атрибут "+this.item.name+"?")&&F.post("Attributes/Remove",{id:this.item.id}).then((function(){return e.$emit("attribute:deleted",e.item)})).catch((function(e){return console.log(e)})):this.$emit("attribute:deleted",this.item)},toggleCode:function(){this.item.handler||(this.code=!this.code)}},mounted:function(){this.attribute.id||(this.edit=!0)}},xe=_e,Ce=(i("2550"),i("8dd9")),$e=i("3a2f"),ke=Object(o["a"])(xe,be,ge,!1,null,null,null),we=ke.exports;d()(ke,{VBtn:K["a"],VCol:le["a"],VIcon:X["a"],VRow:oe["a"],VSelect:B["a"],VSheet:Ce["a"],VSpacer:M["a"],VTextField:R["a"],VTooltip:$e["a"]});var Oe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i(e.readonly?"v-sheet":"v-expansion-panel-header",{tag:"component",staticClass:"pr-2 pb-1 v-expansion-panel-header",attrs:{color:e.color},scopedSlots:e._u([{key:"actions",fn:function(){return[i("v-icon",{staticClass:"ml-3 mr-1 mt-n1"},[e._v("icon-chevron-down")])]},proxy:!0}])},[e.isSingle(e.field)?e._e():i("inline-edit-dialog",{scopedSlots:e._u([{key:"input",fn:function(){return[i("v-text-field",{attrs:{value:e.field.rank,label:"Приоритет","single-line":"",type:"number","prepend-icon":"icon-sort",min:"0"},on:{input:function(t){e.field.rank=parseInt(t||"0")}}})]},proxy:!0}],null,!1,147680412)},[i("v-btn",{staticClass:"ml-n2",attrs:{icon:"",small:"",title:"Порядковый номер (нажмите, чтобы изменить)"}},[e._v(" #"+e._s(e.field.rank)+" ")])],1),i("span",{staticStyle:{"padding-left":"1px","padding-right":"4px"}},[e._v(" <"+e._s(e.item.name||"введите элемент")+"> ")]),i("span",{staticClass:"pl-1 grey--text"},[e.item.label.replace(" *","")!==e.item.name?i("span",[e._v(e._s(e.item.label.replace(" *","")))]):e._e(),e.item.id?e._e():i("small",[e._v(" (выберите тип)")])]),e.item.help?i("v-tooltip",{attrs:{bottom:"","max-width":400,"close-delay":200,attach:!0},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[i("v-btn",e._g({staticClass:"ml-1",attrs:{small:"",icon:""}},n),[i("v-icon",[e._v(" icon-question-circle ")])],1)]}}],null,!1,939607689)},[i("div",{staticClass:"text-caption",staticStyle:{"white-space":"pre-line"}},[e._v(e._s(e.item.help))])]):e._e(),i("v-spacer"),e.edited?[i("v-btn",{staticClass:"ml-1",attrs:{small:"",icon:"",title:"Отменить изменения",color:"orange darken-1"},on:{click:function(t){return t.stopPropagation(),e.$emit("edit:cancel")}}},[i("v-icon",[e._v("icon-rotate-left")])],1),i("v-btn",{staticClass:"ml-2 mb-1",attrs:{small:"",title:"Сохранить изменения",color:"secondary",height:"26"},on:{click:function(t){return t.stopPropagation(),e.saveField(t)}}},[i("v-icon",{attrs:{left:""}},[e._v("icon-save")]),e._v(" Сохранить ")],1)]:[e.field.id?i("v-btn",{staticClass:"px-0",attrs:{small:"",depressed:"",title:e.disabledAddAttribute?"Сначала сохраните новый":"Добавить атрибут",color:"transparent","min-width":"40",disabled:e.disabledAddAttribute},on:{click:function(t){return e.$emit("attribute:add",t)}}},[i("v-icon",{staticClass:"icon-xs mr-1",attrs:{color:"grey darken-1"}},[e._v("icon-plus")]),i("v-icon",{staticClass:"icon-xs",attrs:{color:"grey darken-1"}},[e._v("icon-font")])],1):e._e(),e.field.id?i("v-btn",{staticClass:"ml-1",attrs:{small:"",icon:"",title:"Отредактировать название и тип поля",color:e.edit?"secondary":"default"},on:{click:function(t){return e.$emit("edit:toggle",t)}}},[i("v-icon",[e._v("icon-pencil")])],1):e._e(),e.isSingle(e.field)?e._e():i("v-btn",{staticClass:"ml-1",attrs:{small:"",icon:"",title:"Удалить поле"},on:{click:function(t){return t.stopPropagation(),e.deleteField(t)}}},[i("v-icon",[e._v("icon-trash")])],1)]],2)},je=[],Te=(i("c79c"),i("e4d3")),Ve=i("7560"),Se=i("80d2"),Pe=i("afdd"),Fe=i("326d"),Ae=i("58df"),Le=Object(Ae["a"])(Te["a"],Ve["a"]).extend({name:"inline-edit-dialog",props:{cancelText:{default:"Cancel"},large:Boolean,eager:Boolean,persistent:Boolean,saveText:{default:"Save"},transition:{type:String,default:"slide-x-reverse-transition"}},data:function(){return{isActive:!1}},watch:{isActive:function(e){e?(this.$emit("open"),setTimeout(this.focus,50)):this.$emit("close")}},methods:{cancel:function(){this.isActive=!1,this.$emit("cancel")},focus:function(){var e=this.$refs.content.querySelector("input");e&&e.focus()},genButton:function(e,t){return this.$createElement(Pe["a"],{props:{text:!0,color:"primary",light:!0},on:{click:e}},t)},genActions:function(){var e=this;return this.$createElement("div",{class:"v-small-dialog__actions"},[this.genButton(this.cancel,this.cancelText),this.genButton((function(){e.save(e.returnValue),e.$emit("save")}),this.saveText)])},genContent:function(){var e=this;return this.$createElement("div",{staticClass:"v-small-dialog__content",on:{keydown:function(t){t.keyCode===Se["y"].esc&&e.cancel(),t.keyCode===Se["y"].enter&&(e.save(e.returnValue),e.$emit("save"))}},ref:"content"},[this.$slots.input])}},render:function(e){var t=this;return e(Fe["a"],{staticClass:"v-small-dialog",class:this.themeClasses,props:{contentClass:"v-small-dialog__menu-content",transition:this.transition,origin:"top right",right:!0,value:this.isActive,closeOnClick:!this.persistent,closeOnContentClick:!1,eager:this.eager,light:this.light,dark:this.dark,attach:!0},on:{input:function(e){return t.isActive=e}},scopedSlots:{activator:function(i){var n=i.on;return e("div",{staticClass:"v-small-dialog__activator",on:n},[e("span",{staticClass:"v-small-dialog__activator__content"},t.$slots.default)])}}},[this.genContent(),this.large?this.genActions():null])}}),Ee=i("c865"),Ie={name:"FieldHeader",props:{field:{required:!0,type:Object},item:{required:!0,type:Object},color:{type:String,default:"grey lighten-3"},edit:{type:Boolean,default:!1},disabledAddAttribute:{type:Boolean,default:!1},readonly:{type:Boolean,default:!0}},components:{InlineEditDialog:Le,VSheet:Ce["a"],VExpansionPanelHeader:Ee["a"]},computed:Object($["a"])(Object($["a"])({},Object(L["b"])("field",["isRoot","isSingle","typeText","isUnique","isSimpleString"])),{},{edited:function(){return JSON.stringify(this.item)!==JSON.stringify(this.field)}}),methods:{deleteField:function(){var e=this;this.field.id?confirm("Вы действительно хотите удалить поле "+this.field.name+"?")&&F.post("Fields/Remove",{id:this.field.id}).then((function(){return e.$emit("field:deleted",e.field)})).catch((function(e){return console.log(e)})):this.$emit("field:deleted",this.field)},saveField:function(e){var t=this;setTimeout((function(){F.post(t.field.id?"Fields/Update":"Fields/Create",t.field).then((function(i){var n=i.data;t.$emit("edit:toggle",e,!1),t.$nextTick().then((function(){return t.$emit("field:updated",n.object)}))})).catch((function(e){return console.error(e)}))}),10)}}},Ke=Ie,De=Object(o["a"])(Ke,Oe,je,!1,null,null,null),Ne=De.exports;d()(De,{VBtn:K["a"],VIcon:X["a"],VSpacer:M["a"],VTextField:R["a"],VTooltip:$e["a"]});var Ue=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"yandexmarket-field-value"},[i("v-card-title",{staticClass:"pa-0 flex-nowrap"},[e.isCurrencies(e.field)?[i("v-select",{attrs:{value:e.field.value,items:e.field.values,filled:"",dense:"",multiple:"",solo:"",chips:"","deletable-chips":"","prepend-inner-icon":"icon-tags","small-chips":"","hide-details":"auto","item-value":"value","item-text":"text","menu-props":{offsetY:!0},attach:!0},on:{change:e.changedValue},scopedSlots:e._u([{key:"selection",fn:function(t){var n=t.attrs,a=t.index,s=t.item,r=t.selected;return[i("v-chip",e._b({attrs:{"input-value":r,"text-color":"white",color:a?"grey":"primary",title:a?"Выбрать основной":"Основная валюта",close:"",small:""},on:{click:function(t){return t.stopPropagation(),e.makeFirst(s)},"click:close":function(t){return e.removeChip(s)}}},"v-chip",n,!1),[s.value?i("strong",[e._v(e._s(s.value))]):e._e(),s.text?i("span",{staticClass:"pl-1"},[e._v("("+e._s(s.text)+")")]):i("span",[e._v(e._s(s))])])]}}],null,!1,2245947491)})]:e.isSimpleString(e.field)?[i("v-text-field",{attrs:{value:e.field.value,label:"Введите значение",placeholder:"Попадёт в XML без обработки и замен плейсхолдеров","hide-details":"",solo:"",dense:""},on:{input:e.changedValue},scopedSlots:e._u([{key:"prepend-inner",fn:function(){return[i("div",{staticClass:"text-no-wrap mr-2"},[i("v-icon",{attrs:{left:"",color:"inherit"}},[e._v("icon-paragraph")]),i("code",{staticStyle:{position:"relative",top:"1px"}},[e._v("Текст")])],1)]},proxy:!0}])})]:e.isRawXml(e.field)?[i("div",{staticClass:"text-caption"},[e._v(" Результат не оборачивается. Убедитесь, что формируете валидный XML. Это стандартный Fenom-обработчик, где доступны соответствующие поля. ")])]:[i("v-combobox",{attrs:{value:e.value,filter:e.valueSearch,items:e.classKeys.filter((function(e){return!e.skipped})),attach:!0,label:"Выберите поле объекта",placeholder:'или введите в формате "Class.key" и нажмите Enter',"item-value":"value","item-text":"text","hide-details":"",solo:"",dense:"",clearable:""},on:{input:e.changedValue},scopedSlots:e._u([{key:"prepend-inner",fn:function(){return[i("div",{staticClass:"text-no-wrap mr-2"},[i("v-icon",{attrs:{left:"",color:"inherit"}},[e._v("icon-list-ul")]),i("code",{staticStyle:{position:"relative",top:"1px"}},[e._v(e._s(e.valuePrepend))])],1)]},proxy:!0},{key:"item",fn:function(t){var n=t.item;return[i("code",[e._v(e._s(n.value))]),i("span",{staticClass:"pl-1"},[e._v(e._s(n.text))]),n.help?i("small",{staticClass:"pl-1 grey--text"},[e._v(" ("+e._s(n.help)+")")]):e._e()]}}])}),e.isPicture(e.field)?i("v-text-field",{staticClass:"ml-2",staticStyle:{"max-width":"100px"},attrs:{value:e.field.properties.count,type:"number",title:"Количество изображений для каждого товара (10 максимум)",min:"0",max:"10",label:"Кол-во",solo:"",dense:"","hide-details":""},on:{input:e.countChanged}}):i("v-btn",{staticClass:"ml-3",attrs:{title:e.openedCode?"Для закрытия очистите введённый код":"Добавить код-обработчик значения",color:e.openedCode?"secondary":"accent","min-width":"30",elevation:"0"},on:{click:e.toggleCode}},[i("v-icon",[e._v("icon-code")])],1)]],2),e.openedCode?i("v-sheet",{staticClass:"mt-2",staticStyle:{position:"relative"},attrs:{elevation:"1"}},[e.rerender?i("vue-codemirror",{attrs:{options:e.cmOptions,placeholder:"Пример: {$input === 'Да' ? true : false}"},model:{value:e.field.handler,callback:function(t){e.$set(e.field,"handler",t)},expression:"field.handler"}}):e._e(),i("v-tooltip",{attrs:{left:"","max-width":450,"close-delay":200,attach:!0},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[i("v-btn",e._g({staticStyle:{right:"-4px",top:"-4px"},attrs:{"x-small":"",fab:"",icon:"",absolute:""}},n),[i("v-icon",{attrs:{color:"grey darken-1"}},[e._v("icon-question-circle")])],1)]}}],null,!1,403900664)},[i("div",{staticClass:"text-caption",staticStyle:{"white-space":"pre-line"}},[e._v(" INLINE обработка поля на Fenom (значение попадает в $input)"),i("br"),e._v(" Нужно для приведения к boolean, вырезанию лишних тегов/текстов, обработки массивов, ТВ-полей или для независимых значений. "),i("br"),i("br"),e._v(" Доступны поля ресурса {$resource.pagetitle}, товаров miniShop2 {$data.price}, опций ms2 {$option.color}, тв полей {$tv.tag}."),i("br"),e._v(" Все нужные ТВ-поля, опции будут приджойнены автоматически."),i("br"),i("br"),e._v(" Писать @INLINE перед кодом НЕ нужно. ")])])],1):e._e()],1)},qe=[],Xe=i("2909"),Be={name:"FieldValue",props:{field:{type:Object,required:!0}},components:{VueCodemirror:ae["codemirror"]},data:function(){return{rerender:!0,code:!1,cmOptions:{taSize:4,mode:{name:"smarty",baseMode:"text/html",version:3},line:!0,lineNumbers:!0,lineWrapping:!0}}},computed:Object($["a"])(Object($["a"])(Object($["a"])({},Object(L["b"])(["dataColumnsForGroup"])),Object(L["b"])("field",["isSimpleString","isCurrencies","isCategories","isOffers","isShop","isPicture","isRawXml"])),{},{classKeys:function(){var e=null;return-1!==this.$route.name.indexOf(".categories")?e="categories":-1!==this.$route.name.indexOf(".offers")&&(e="offers"),this.dataColumnsForGroup(e)},value:function(){var e=this;if("object"===Object(k["a"])(this.field.value))return this.field.value;var t=this.classKeys.find((function(t){return t.value===e.field.value}));return{value:this.field.value,text:t?t.text:this.field.value}},valuePrepend:function(){return this.value&&this.value.value!==this.value.text?this.value.value:"Поле"},openedCode:function(){return this.field.handler||this.code||this.isRawXml(this.field)}}),methods:{valueSearch:function(e,t,i){return i.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1||e&&e.value&&e.value.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1},changedValue:function(e){var t;t=null===e?null:Array.isArray(e)?e:"object"===Object(k["a"])(e)?e.value:e,this.$emit("input",t)},toggleCode:function(){this.field.handler||(this.code=!this.code)},removeChip:function(e){var t=Object(Xe["a"])(this.field.value);t.splice(t.indexOf(e.value),1),this.changedValue(t)},makeFirst:function(e){var t=Object(Xe["a"])(this.field.value);t.splice(t.indexOf(e.value),1),t.unshift(e.value),this.changedValue(t)},countChanged:function(e){var t=this.field.properties;t.count=e?parseInt(e):0,this.$set(this.field,"properties",t)}},mounted:function(){var e=this;this.code=!!this.field.handler,this.rerender=!1,setTimeout((function(){return e.rerender=!0}))}},Me=Be,Re=(i("b950"),i("cc20")),Ge=Object(o["a"])(Me,Ue,qe,!1,null,null,null),Ye=Ge.exports;d()(Ge,{VBtn:K["a"],VCardTitle:N["c"],VChip:Re["a"],VCombobox:ye["a"],VIcon:X["a"],VSelect:B["a"],VSheet:Ce["a"],VTextField:R["a"],VTooltip:$e["a"]});var He={name:"PricelistField",components:{FieldValue:Ye,FieldHeader:Ne,FieldAttribute:we},props:{item:{required:!0,type:[Object]},attributes:{type:Array,default:function(){return[]}},fields:{type:Array,default:function(){return[]}},lighten:{type:Number,default:2},availableFields:{type:Array,default:function(){return[]}},availableTypes:{type:Array,default:function(){return[]}},parent:{default:null},readonly:{default:!0}},data:function(){return{field:{},attrs:[],children:[],opened:[],edit:!1,code:!1,attributesToAdd:[]}},watch:{item:{immediate:!0,handler:function(e){var t=this;this.field=Object($["a"])(Object($["a"])({},this.field),e),Object.keys(e.properties).length&&(this.field.properties=Object($["a"])({},e.properties)),this.$nextTick().then((function(){return t.code=!!t.field.handler}))}},fields:{immediate:!0,handler:function(e){var t=this;this.item.id&&(this.children=e.filter((function(e){return e.parent===t.item.id})).slice().sort((function(e,t){return e.rank-t.rank}))),this.$nextTick().then((function(){return t.opened=Object.keys(t.children).map((function(e,t){return t}))}))}},attributes:{immediate:!0,handler:function(e){var t=this;this.attrs=e.filter((function(e){return e.field_id===t.item.id})).slice()}}},computed:Object($["a"])(Object($["a"])({},Object(L["b"])("field",["isParent","isEmptyType","findByType","isRoot","isShop","isOffers","isCategories"])),{},{availableType:function(){var e=this;return this.availableTypes.find((function(t){return t.value===e.field.type}))},realType:function(){return this.findByType(this.field.type)},types:function(){var e=this.availableTypes.slice();return this.realType&&!this.availableType&&e.push(this.realType),e}}),mounted:function(){this.field.id||(this.edit=!0)},methods:{fieldUpdated:function(e){if(this.$emit("field:updated",e),Object.keys(this.attributesToAdd).length)for(var t in this.attributesToAdd)Object.prototype.hasOwnProperty.call(this.attributesToAdd,t)&&this.attributesToAdd[t].required&&this.addAttribute(null,e.id,t,this.attributesToAdd[t].type)},changedName:function(e){var t;null===e?t=null:"object"===Object(k["a"])(e)?(t=e.value,"undefined"!==e.type&&(this.field.type=e.type,e.values?(this.field.values=e.values,this.field.properties.values=e.values):(delete this.field.values,delete this.field.properties.values),e.attributes?this.attributesToAdd=e.attributes:this.attributesToAdd=[])):t=e,this.field.name=t},addField:function(){this.$emit("field:created",{id:null,name:null,type:null,label:"Новое поле",text:"",help:"Описание поля можно задать через лексиконы",value:null,handler:null,pricelist_id:this.field.pricelist_id,parent:this.field.id,rank:Object.keys(this.children).length+1,properties:{custom:!0}})},cancelEdit:function(){this.field=Object($["a"])(Object($["a"])({},this.field),this.item),Object.keys(this.item.properties).length&&(this.field.properties=Object($["a"])({},this.item.properties))},toggleEdit:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!this.edit;e&&this.$refs["panel"+this.field.id]&&this.$refs["panel"+this.field.id].isActive&&e.stopPropagation(),this.edit=t},addAttribute:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.field.id,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Новый атрибут";e&&this.$refs["panel"+this.field.id]&&this.$refs["panel"+this.field.id].isActive&&e.stopPropagation(),this.$emit("attribute:created",{id:null,field_id:t,handler:null,label:a,name:i,value:null,type:n,properties:{custom:!0}})}}},We=He,Je=(i("8b71"),i("cd55")),ze=i("49e2"),Qe=i("0393"),Ze=Object(o["a"])(We,ve,me,!1,null,null,null),et=Ze.exports;d()(Ze,{VBtn:K["a"],VCardText:N["b"],VCol:le["a"],VCombobox:ye["a"],VExpansionPanel:Je["a"],VExpansionPanelContent:ze["a"],VExpansionPanels:Qe["a"],VIcon:X["a"],VRow:oe["a"],VSelect:B["a"],VSpacer:M["a"]});var tt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"yandexmarket-pricelist-conditions mb-n5"},[e._l(e.conditions,(function(t){return i("pricelist-condition",e._g({key:t.id,attrs:{item:t}},e.$listeners))})),i("div",{staticClass:"text-right"},[i("v-btn",{staticClass:"mt-3 mb-0",attrs:{small:"",color:"grey lighten-4",disabled:!!e.conditions.filter((function(e){return!e.id})).length},on:{click:e.addCondition}},[i("v-icon",{staticClass:"icon-sm",attrs:{left:""}},[e._v("icon-plus")]),e.conditions.filter((function(e){return!e.id})).length?[e._v(" Сохраните новое условие ")]:[e._v(" Добавить условие ")]],2)],1)],2)},it=[],nt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-sheet",{staticClass:"pa-2 yandexmarket-pricelist-condition",attrs:{elevation:"1"}},[i("v-row",{staticClass:"mr-6",attrs:{dense:""}},[i("v-col",{attrs:{cols:"12",sm:"4"}},[i("v-combobox",{staticClass:"mb-0",attrs:{value:e.column,filter:e.valueSearch,items:e.classKeys.filter((function(e){return!e.skipped})),attach:!0,label:e.columnLabel,placeholder:'Или введите в формате "Class.key"',"item-value":"value","item-text":"text",disabled:!e.edit,"hide-details":"",filled:"",dense:"","background-color":"white"},on:{input:e.changedColumn},scopedSlots:e._u([{key:"item",fn:function(t){var n=t.item;return[i("code",[e._v(e._s(n.value))]),i("span",{staticClass:"pl-1"},[e._v(e._s(n.text))]),n.help?i("small",{staticClass:"pl-1 grey--text"},[e._v(" ("+e._s(n.help)+")")]):e._e()]}}])})],1),i("v-col",{attrs:{cols:"12",sm:"4"}},[i("v-select",{staticClass:"mb-0",attrs:{label:"Оператор "+(e.operator?e.operator.sign:""),items:e.operatorsList,dense:"","menu-props":{offsetY:!0},attach:!0,filled:"","background-color":"white",disabled:!e.edit,"hide-details":""},model:{value:e.condition.operator,callback:function(t){e.$set(e.condition,"operator",t)},expression:"condition.operator"}})],1),i("v-col",{attrs:{cols:"12",sm:"4"}},[e.selectable?i("v-combobox",{staticClass:"mb-0",attrs:{value:e.condition.value,filter:e.valueSearch,items:e.values,attach:!0,label:"Значение",placeholder:"Введите или выберите из списка","item-value":"value","item-text":"text",disabled:!e.edit,"hide-details":"",filled:"",dense:"","background-color":"white",multiple:e.arrayValue},on:{input:e.changedValue}}):e.nullValue?e._e():i("v-text-field",{staticClass:"mb-0",attrs:{value:e.condition.value,label:"Значение",placeholder:"Введите значение",disabled:!e.edit,"hide-details":"",filled:"",dense:"","background-color":"white"},on:{input:e.changedValue}})],1)],1),i("div",{staticClass:"yandexmarket-pricelist-condition-actions align-center justify-center"},[e.edited?[i("v-btn",{attrs:{small:"",icon:"",title:"Отменить изменения",color:"orange darken-1"},on:{click:e.cancelEdit}},[i("v-icon",[e._v("icon-rotate-left")])],1),i("v-btn",{attrs:{small:"",icon:"",title:"Сохранить изменения",color:"secondary",height:"26"},on:{click:e.saveChanges}},[i("v-icon",[e._v("icon-save")])],1)]:[i("v-btn",{attrs:{small:"",icon:"",title:"Отредактировать условие",color:e.edit?"secondary":"default"},on:{click:e.editCondition}},[i("v-icon",[e._v("icon-pencil")])],1),i("v-btn",{attrs:{small:"",icon:"",title:"Удалить условие"},on:{click:function(t){return t.stopPropagation(),e.deleteCondition(t)}}},[i("v-icon",[e._v("icon-trash")])],1)]],2)],1)},at=[],st={name:"PricelistCondition",props:{item:{required:!0,type:Object}},data:function(){return{edit:!1,condition:{},values:[]}},watch:{item:{immediate:!0,handler:function(e){this.condition=Object($["a"])(Object($["a"])({},this.condition),e)}},"condition.column":{immediate:!0,handler:function(e){e&&this.loadValues()}}},computed:Object($["a"])(Object($["a"])({},Object(L["b"])(["operatorsList","dataColumnsForGroup"])),{},{classKeys:function(){var e=null;return-1!==this.$route.name.indexOf(".categories")?e="categories":-1!==this.$route.name.indexOf(".offers")&&(e="offers"),this.dataColumnsForGroup(e)},edited:function(){return JSON.stringify(this.item)!==JSON.stringify(this.condition)},operator:function(){var e=this;return this.operatorsList.find((function(t){return t.value===e.condition.operator}))},selectable:function(){return!(!this.operator||!this.operator.select)},nullValue:function(){return!(!this.operator||!this.operator.valueless)},arrayValue:function(){return!(!this.operator||!this.operator.multiple)},column:function(){var e=this;if("object"===Object(k["a"])(this.condition.column))return this.condition.column;var t=this.classKeys.find((function(t){return t.value===e.condition.column}));return{value:this.condition.column,text:t?t.text:this.condition.column}},columnLabel:function(){return this.column&&this.column.value!==this.column.text?"Поле "+this.column.value:"Поле"}}),methods:{deleteCondition:function(){var e=this;this.condition.id?confirm("Вы действительно хотите удалить это условие?")&&F.post("Conditions/Remove",{id:this.condition.id}).then((function(){return e.$emit("condition:deleted",e.condition)})).catch((function(e){return console.log(e)})):this.$emit("condition:deleted",this.condition)},editCondition:function(){this.edit=!this.edit},cancelEdit:function(){this.condition=Object($["a"])(Object($["a"])({},this.condition),this.item)},saveChanges:function(){var e=this;setTimeout((function(){F.post(e.condition.id?"Conditions/Update":"Conditions/Create",e.condition).then((function(t){var i=t.data;e.edit=!1,e.$nextTick().then((function(){return e.$emit("condition:updated",i.object)}))})).catch((function(e){return console.error(e)}))}),10)},changedColumn:function(e){var t;t=null===e?null:Array.isArray(e)?e:"object"===Object(k["a"])(e)?e.value:e,this.condition.column=t,this.condition.value=this.arrayValue?[]:null},changedValue:function(e){var t;t=null===e?null:Array.isArray(e)?e:"object"===Object(k["a"])(e)?e.value:e,this.condition.value=t},valueSearch:function(e,t,i){return i.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1||e&&e.value&&e.value.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1},loadValues:function(){var e=this;F.post("Lists/Values",{column:this.condition.column}).then((function(t){var i=t.data;return e.values=(i.results||[]).filter((function(e){return null!==e&&""!==e}))}))}},mounted:function(){this.condition.id||(this.edit=!0)}},rt=st,lt=(i("1688"),Object(o["a"])(rt,nt,at,!1,null,null,null)),ot=lt.exports;d()(lt,{VBtn:K["a"],VCol:le["a"],VCombobox:ye["a"],VIcon:X["a"],VRow:oe["a"],VSelect:B["a"],VSheet:Ce["a"],VTextField:R["a"]});var ct={name:"PricelistConditions",components:{PricelistCondition:ot},props:{conditions:{required:!0},pricelist:{required:!0}},methods:{addCondition:function(){this.$emit("condition:created",{id:null,pricelist_id:this.pricelist.id,column:null,operator:null,value:null})}}},dt=ct,ut=Object(o["a"])(dt,tt,it,!1,null,null,null),pt=ut.exports;d()(ut,{VBtn:K["a"],VIcon:X["a"]});var ft={name:"PriceListOffer",components:{PricelistConditions:pt,PricelistOfferField:et},props:{pricelist:{type:Object,required:!0}},data:function(){return{openedFields:[0],where:"",classKey:"",classKeyDisabled:!0,hasErrors:!0,cmOptions:{lineNumbers:!0,mode:"application/json",gutters:["CodeMirror-lint-markers"],lint:!1,lineWrapping:!0}}},watch:{"pricelist.where":{immediate:!0,handler:function(e){this.where=e}},"pricelist.class":{immediate:!0,handler:function(e){this.classKey=e,this.classKeyDisabled=!0}}},computed:Object($["a"])(Object($["a"])(Object($["a"])({},Object(L["b"])("marketplace",["availableFields"])),Object(L["b"])("field",["availableTypes"])),{},{offerField:function(){return this.pricelist.fields.find((function(e){return 6===e.type}))},editedWhere:function(){return(this.where||"")!==(this.pricelist.where||"")}}),methods:{previewXml:function(){this.$emit("preview:xml","offers")},saveClass:function(){this.$emit("pricelist:updated",{class:this.classKey})},cancelClass:function(){this.classKey=this.pricelist.class,this.classKeyDisabled=!0},saveWhere:function(){this.$emit("pricelist:updated",{where:this.where?this.where:null})},resetWhere:function(){this.where=this.pricelist.where||""}},mounted:function(){this.previewXml(),this.openedFields=[0]}},ht=ft,vt=(i("e48b"),i("0798")),mt=i("0e8f"),bt=Object(o["a"])(ht,fe,he,!1,null,null,null),gt=bt.exports;d()(bt,{VAlert:vt["a"],VBtn:K["a"],VExpansionPanels:Qe["a"],VFlex:mt["a"],VIcon:X["a"],VRow:oe["a"],VSpacer:M["a"],VTextField:R["a"],VTooltip:$e["a"]});var yt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"yandexmarket-pricelist-settings"},[i("h4",[e._v(e._s(e.$t("Shop main fields settings")))]),i("p",{staticClass:"mb-2"},[e._v(e._s(e.$t("Required fields are marked with an asterisk."))+" "+e._s(e.$t("Do not forget to save your changes.")))]),e.shopField?i("v-expansion-panels",{key:"offers",staticClass:"pb-2",attrs:{multiple:""},model:{value:e.openedFields,callback:function(t){e.openedFields=t},expression:"openedFields"}},[i("pricelist-field",e._g({attrs:{item:e.shopField,fields:e.pricelist.fields,attributes:e.pricelist.attributes,lighten:3,"available-fields":e.availableFields("shop",e.pricelist),"available-types":e.availableTypes("shop",e.pricelist)}},e.$listeners))],1):e._e(),i("p",[e._v(e._s(e.$t("Empty fields will not be included in the file."))+" "+e._s(e.$t("The save changes button appears after you start editing.")))])],1)},_t=[],xt={name:"PriceListShop",components:{PricelistField:et},props:{pricelist:{type:Object,required:!0}},data:function(){return{openedFields:[0]}},computed:Object($["a"])(Object($["a"])(Object($["a"])({},Object(L["b"])("marketplace",["availableFields"])),Object(L["b"])("field",["availableTypes"])),{},{shopField:function(){return this.pricelist.fields.find((function(e){return 2===e.type}))}}),methods:{previewXml:function(){this.$emit("preview:xml","shop")}},mounted:function(){this.previewXml(),this.openedFields=[0]}},Ct=xt,$t=Object(o["a"])(Ct,yt,_t,!1,null,null,null),kt=$t.exports;d()($t,{VExpansionPanels:Qe["a"]});var wt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"yandexmarket-pricelist-categories"},[i("h4",[e._v(e._s(e.$t("Categories involved in file generation - nested categories must also be selected")))]),i("p",{staticClass:"mb-2"},[e._v(e._s(e.$t("If nothing is selected, the categories of all matching products will be unloaded")))]),i("CategoriesTree",e._g({attrs:{selected:e.selected,categories:e.categories,where:{pricelist_id:e.pricelist.id}},on:{"contexts:loaded":function(t){e.categories=t},"tree:reload":e.treeReload}},e.$listeners)),e.categoryField?[i("h4",{staticClass:"mb-1 mt-2"},[e._v(e._s(e.$t("Category element settings in XML")))]),i("v-expansion-panels",{key:"offers",staticClass:"pb-2",attrs:{multiple:""},model:{value:e.openedFields,callback:function(t){e.openedFields=t},expression:"openedFields"}},[i("pricelist-field",e._g({attrs:{item:e.categoryField,fields:e.pricelist.fields,attributes:e.pricelist.attributes,lighten:3,"available-fields":[],"available-types":[]}},e.$listeners))],1)]:i("v-alert",{attrs:{type:"info",color:"grey",dense:"",border:"left"}},[e._v(" "+e._s(e.$t('An element of type "category" was not found.'))+" "+e._s(e.$t("The categories element may have been removed or is not needed in the file."))+" "+e._s(e.$t("Only the conditions will be considered"))+" ")])],2)},Ot=[],jt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-card",{attrs:{loading:e.loading,flat:"",tile:""}},[i("v-toolbar",{attrs:{flat:"",color:"grey lighten-2",dense:"",height:"40"}},[e.selected.length?i("span",[e._v("Выбрано "+e._s(e.declension(e.selected.length,["категория","категории","категорий"])))]):i("span",[e._v("Выберите категории для выгрузки")]),i("v-spacer"),i("v-btn",{attrs:{small:"",icon:"",title:"Раскрыть все категории"},on:{click:e.expandTree}},[i("v-icon",[e._v("icon icon-expand")])],1),i("v-btn",{attrs:{small:"",icon:"",title:"Свернуть все категории"},on:{click:e.collapseTree}},[i("v-icon",[e._v("icon icon-compress")])],1),i("v-btn",{attrs:{small:"",icon:"",title:"Обновить дерево"},on:{click:e.reloadTree}},[i("v-icon",[e._v("icon icon-refresh")])],1)],1),i("v-card-text",{staticClass:"px-0 pt-0 pb-2"},[i("v-treeview",{ref:"categoriesTree",staticClass:"yandexmarket-categories",attrs:{items:e.categories,"load-children":e.loadCategories,"item-text":e.itemText,"item-key":e.itemKey,"selection-type":"independent","item-children":"children","open-on-click":"",hoverable:"",dense:""},scopedSlots:e._u([{key:"prepend",fn:function(t){var n=t.item;return[n.selectable?i("v-simple-checkbox",{staticClass:"text-center",attrs:{title:"Выбрать категорию",color:"primary",value:-1!==e.selected.indexOf(n[e.itemKey])},on:{click:function(e){e.stopPropagation()},input:function(t){return e.selectCategory(t,n)}}}):e._e()]}},{key:"label",fn:function(t){var n=t.item;return[i("div",{staticClass:"v-treeview-node__content"},[i("div",{staticClass:"v-treeview-node__prepend"},[n.iconCls?i("v-icon",{staticClass:"mx-1 v-treeview-label__icon"},[e._v("icon "+e._s(n.iconCls))]):e._e()],1),i("div",{staticClass:"v-treeview-node__label",domProps:{innerHTML:e._s(n.text)}}),n.hasChildren?i("div",{staticClass:"v-treeview-action"},[i("v-btn",{attrs:{icon:"",small:"",title:"Выбрать со всеми подкатегориями"},on:{click:function(t){return t.stopPropagation(),e.recursiveSelect(n)}}},[i("v-icon",[e._v("icon icon-magic")])],1)],1):e._e()])]}}])})],1)],1)},Tt=[],Vt={name:"CategoriesTree",props:{selected:{type:Array,default:function(){return[]}},categories:{type:Array,default:function(){return[]}},where:{type:Object,required:!0}},data:function(){return{itemKey:"pk",itemText:"text",loading:!1,opened:[],loaded:[],awaitChildren:{}}},methods:{declension:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return A(e,t,i)},selectCategory:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e?(this.$emit("category:added",t[this.itemKey],i),t.selected=!0):(this.$emit("category:removed",t[this.itemKey],i),t.selected=!1)},recursiveSelect:function(e){var t=this,i=this.categories.find((function(t){return t.pk===e.ctx}));if(!i)return!1;var n=this.findNode(e[this.itemKey],i);if(!n)return!1;this.loadCategories(n).then((function(e){n.hasChildren&&t.$refs.categoriesTree&&t.$refs.categoriesTree.updateOpen(n[t.itemKey],!0),t.selectCategory(!n.selected,n,!0),e&&e.length&&e.forEach((function(e){t.$nextTick().then((function(){return t.recursiveSelect(e)}))}))}))},loadCategories:function(e){var t=this;return this.loading=!0,this.awaitChildren[e[this.itemKey]]&&delete this.awaitChildren[e[this.itemKey]],F.post("Categories/GetList",Object($["a"])(Object($["a"])({},this.where),{},{id:e.id})).then((function(i){var n=i.data;return t.$set(e,"children",n),n.forEach((function(e){e.selected&&t.$emit("category:added",e[t.itemKey],!1),e.hasChildren&&(t.awaitChildren[e[t.itemKey]]=!0),e.expanded&&t.$refs.categoriesTree&&setTimeout((function(){t.$refs.categoriesTree.updateOpen(e[t.itemKey],!0)}),50)})),t.loading=!1,n})).catch((function(e){console.error(e),t.loading=!1}))},loadContexts:function(){var e=this;this.loading=!0,F.post("Categories/GetList",Object($["a"])(Object($["a"])({},this.where),{},{id:"root"})).then((function(t){var i=t.data;return e.$emit("contexts:loaded",i)})).catch((function(e){return console.error(e)})).then((function(){e.loading=!1,e.$nextTick().then((function(){return e.$refs.categoriesTree.updateAll(!0)}))}))},reloadTree:function(){this.$emit("tree:reload"),this.loadContexts()},expandTree:function(){var e=this;this.$refs.categoriesTree.updateAll(!0),setTimeout((function(){Object.keys(e.awaitChildren).length>0&&e.expandTree()}),200)},collapseTree:function(){this.$refs.categoriesTree.updateAll(!1)},findNode:function(e,t){var i,n,a;if(e===t[this.itemKey])return t;if(t.children)for(i=0;i<t.children.length;i+=1)if(n=t.children[i],a=this.findNode(e,n),!1!==a)return a;return!1}},mounted:function(){this.loadContexts()}},St=Vt,Pt=(i("3d82"),i("9e88")),Ft=i("71d9"),At=i("eb2a"),Lt=Object(o["a"])(St,jt,Tt,!1,null,"2c6f8a01",null),Et=Lt.exports;d()(Lt,{VBtn:K["a"],VCard:D["a"],VCardText:N["b"],VIcon:X["a"],VSimpleCheckbox:Pt["a"],VSpacer:M["a"],VToolbar:Ft["a"],VTreeview:At["a"]});var It={name:"PriceListCategories",props:{pricelist:{type:Object,required:!0}},components:{CategoriesTree:Et,PricelistField:et},data:function(){return{openedFields:[0],selected:[],categories:[]}},watch:{"pricelist.categories":{immediate:!0,handler:function(e){this.selected=e||[]}}},computed:{categoryField:function(){return this.pricelist.fields.find((function(e){return 7===e.type}))}},methods:{previewXml:function(){this.$emit("preview:xml","categories")},treeReload:function(){this.categories=[]}},mounted:function(){this.previewXml()}},Kt=It,Dt=Object(o["a"])(Kt,wt,Ot,!1,null,null,null),Nt=Dt.exports;d()(Dt,{VAlert:vt["a"],VExpansionPanels:Qe["a"]});var Ut=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-row",{staticClass:"yandexmarket-pricelist-generate"},[i("v-col",{attrs:{cols:"12",md:"6"}},[i("h4",[e._v(e._s(e.$t("Main parameters of pricelist generation")))]),i("p",{staticClass:"mb-2"},[e._v(e._s(e.$t("All fields are required")))]),i("v-select",{attrs:{filled:"",label:e.$t("Pricelist type (set when creating)"),dense:"",disabled:"",items:e.marketplaces},model:{value:e.data.type,callback:function(t){e.$set(e.data,"type",t)},expression:"data.type"}}),i("v-text-field",{attrs:{filled:"",label:e.$t("Pricelist name"),dense:""},model:{value:e.data.name,callback:function(t){e.$set(e.data,"name",t)},expression:"data.name"}}),i("v-text-field",{staticClass:"mb-1",attrs:{filled:"",dense:"",label:e.$t("Pricelist filename")+" "+e.$t("(specify with xml extension)"),hint:e.$t("The file will be available at {fileUrl}",{fileUrl:e.pricelist.fileUrl})},model:{value:e.data.file,callback:function(t){e.$set(e.data,"file",t)},expression:"data.file"}}),i("v-select",{staticClass:"mb-2",attrs:{filled:"",dense:"",label:e.$t("File generation mode"),items:e.modes,hint:e.modeHint,"persistent-hint":!!e.modeHint,"menu-props":{offsetY:!0},attach:!0},model:{value:e.data.generate_mode,callback:function(t){e.$set(e.data,"generate_mode",t)},expression:"data.generate_mode"}}),e.data.generate_mode?i("v-text-field",{attrs:{filled:"",min:0,dense:"",label:e.$t("Regenerate the file every N minutes, even if there were no changes"),hint:e.$t("0 - no additional updates. To update the file once a day, specify 1440"),type:"number"},model:{value:e.data.generate_interval,callback:function(t){e.$set(e.data,"generate_interval",t)},expression:"data.generate_interval"}}):e._e(),i("v-checkbox",{staticClass:"mt-0 mb-2",attrs:{label:e.data.active?e.$t("Pricelist is active (monitoring changes in settings and related products)"):e.$t("Pricelist is NOT active (activate after setup is complete)"),"hide-details":""},model:{value:e.data.active,callback:function(t){e.$set(e.data,"active",t)},expression:"data.active"}}),i("v-card-actions",{staticClass:"px-0"},[e.hasChanges?i("v-btn",{attrs:{small:"",title:e.$t("Revert all changes")},on:{click:e.cancelChanges}},[i("v-icon",{attrs:{left:""}},[e._v("icon-undo")]),e._v(" "+e._s(e.$t("Cancel changes"))+" ")],1):e._e(),i("v-spacer"),i("v-btn",{attrs:{disabled:!e.hasChanges,color:"secondary",small:""},on:{click:e.saveChanges}},[i("v-icon",{attrs:{left:"",small:""}},[e._v("icon-save")]),e._v(" "+e._s(e.$t("Save"))+" ")],1)],1),e.rootField?[i("h4",{staticClass:"mb-1"},[e._v(e._s(e.$t("File root element settings")))]),i("v-expansion-panels",{key:"offers",staticClass:"pb-2",attrs:{multiple:""},model:{value:e.openedFields,callback:function(t){e.openedFields=t},expression:"openedFields"}},[i("pricelist-field",e._g({attrs:{readonly:!1,item:e.rootField,fields:e.pricelist.fields,attributes:e.pricelist.attributes,lighten:3,"available-fields":[],"available-types":[],parent:"root"}},e.$listeners))],1)]:e._e()],2),i("v-col",{attrs:{cols:"12",md:"6"}},[e.pricelist.need_generate?i("v-alert",{attrs:{type:"warning",dense:""}},[e._v(" "+e._s(e.$t("Products or settings have changed. The file needs to be regenerated!"))+" ")]):e._e(),e.pricelist.generated_on?i("v-alert",{attrs:{type:"info",color:"accent",dense:""}},[e._v(" "+e._s(e.$t("Previous pricelist generated in {generatedAt}",{generatedAt:e.pricelist.generated_on}))+" ")]):e._e(),e.pricelist.generated_on?i("p",[e._v(e._s(e.$t("Link to file:"))+" "),i("a",{attrs:{href:e.pricelist.fileUrl,title:e.$t("The file will open in a new window"),target:"_blank"}},[e._v(e._s(e.pricelist.fileUrl))])]):i("h4",{staticClass:"mb-3"},[e._v(e._s(e.$t("The pricelist has not yet been formed")))]),i("v-btn",{staticClass:"mb-3",attrs:{disabled:e.loading,color:"secondary",title:e.$t("The existing file will be overwritten")},on:{click:e.generateFile}},[e._v(" "+e._s(e.$t("Generate a new file"))+" ")]),i("fieldset",{staticClass:"x-window modx-console zoom-in generation-log pa-2"},[i("legend",{staticClass:"px-2"},[e._v(e._s(e.$t("File generation log")))]),i("div",{staticClass:"modx-console-text px-2",domProps:{innerHTML:e._s(e.log)}})])],1)],1)},qt=[],Xt={name:"PriceListGenerate",props:{pricelist:{required:!0,type:Object}},components:{PricelistField:et},data:function(){return{openedFields:[],data:{},loading:!1,log:this.$t("File generation log will appear here"),modes:[{value:0,text:this.$t("Only manually in the admin panel (manual mode)"),hint:this.$t("If a cron task is set, then this pricelist will not be included")},{value:1,text:this.$t("When changing products on the fly (for small sites)"),hint:this.$t("The pricelist will be formed immediately. Force update by cron")},{value:2,text:this.$t("By cron when changing products (recommended)"),hint:this.$t("Install a cron job every minute at /core/components/yandexmarket2/cron/generate.php")}]}},watch:{pricelist:{immediate:!0,handler:function(e){e.fields,e.categories,e.attributes,e.conditions;var t=Object(J["a"])(e,["fields","categories","attributes","conditions"]);this.data=Object($["a"])(Object($["a"])({},this.data),t)}}},computed:Object($["a"])(Object($["a"])({},Object(L["c"])("marketplace",["marketplaces"])),{},{rootField:function(){return this.pricelist.fields.find((function(e){return 1===e.type}))},modeHint:function(){var e=this,t=this.modes.find((function(t){return t.value===parseInt(e.data.generate_mode)}));return t?t.hint:""},hasChanges:function(){var e=this.pricelist,t=(e.fields,e.categories,e.attributes,e.conditions,Object(J["a"])(e,["fields","categories","attributes","conditions"]));return JSON.stringify(this.data)!==JSON.stringify(t)},topic:function(){return"/generate-".concat(this.pricelist.id,"/")}}),methods:{cancelChanges:function(){var e=this.pricelist,t=(e.fields,e.categories,e.attributes,e.conditions,Object(J["a"])(e,["fields","categories","attributes","conditions"]));this.data=Object($["a"])(Object($["a"])({},this.data),t)},saveChanges:function(){this.$emit("pricelist:updated",Object($["a"])({},this.data))},getLog:function(){var e=this;F.post("Xml/Log",{topic:this.topic}).then((function(t){var i=t.data;i&&i.data&&(e.log+=i.data),i.complete||setTimeout(e.getLog,1e3)}))},generateFile:function(){var e=this;this.pricelist.generated_on&&!confirm(this.$t("Are you sure you want to regenerate the file?")+" "+this.$t("The existing file will be overwritten"))||(this.loading=!0,this.log="",F.post("Xml/Generate",{id:this.pricelist.id,topic:this.topic,clear:!0}).then((function(t){var i=t.data;return e.$emit("pricelist:updated",Object($["a"])({},i.object),!1)})).catch((function(e){return console.error(e)})).then((function(){return e.loading=!1})),setTimeout(this.getLog,100))}}},Bt=Xt,Mt=(i("1b72"),i("ac7c")),Rt=Object(o["a"])(Bt,Ut,qt,!1,null,null,null),Gt=Rt.exports;d()(Rt,{VAlert:vt["a"],VBtn:K["a"],VCardActions:N["a"],VCheckbox:Mt["a"],VCol:le["a"],VExpansionPanels:Qe["a"],VIcon:X["a"],VRow:oe["a"],VSelect:B["a"],VSpacer:M["a"],VTextField:R["a"]});var Yt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-main",[i("component-header"),e.$xmlLoaded?e._e():i("v-alert",{attrs:{type:"warning",dense:""}},[i("b",[e._v("XmlWriter")]),e._v(" "+e._s(e.$t("class not found in the system"))+". "),i("span",{domProps:{innerHTML:e._s(e.$t("Perhaps the php module <i>libxml</i> is disabled or php is started with the flag <i>--disable-xmlwriter</i>"))}})]),i("div",{staticClass:"yandexmarket-view mb-4"},[i("router-view")],1)],1)},Ht=[],Wt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("h2",{staticClass:"mb-5 mt-5 yandexmarket-component-name"},[e._v(" "+e._s(e.$t("YandexMarket2"))+" "),e.breadcrumbs.length>1?i("v-breadcrumbs",{staticClass:"yandexmarket-breadcrumbs",attrs:{items:e.breadcrumbs}}):i("span",{staticClass:"subtitle-1"},[e._v(" - "+e._s(e.$t("uploading offers in XML for Yandex Market and more")))])],1)},Jt=[],zt={name:"ComponentHeader",data:function(){return{items:[]}},computed:{breadcrumbs:function(){var e=this;return this.$route.matched.filter((function(e){return e.meta&&e.meta.title&&(e.name||e.meta.to)})).map((function(t){return{text:t.meta.title,to:{name:t.name||t.meta.to,params:e.$route.params||{}},exact:!0,disabled:!1}}))}}},Qt=zt,Zt=(i("12e0"),i("2bc5")),ei=Object(o["a"])(Qt,Wt,Jt,!1,null,"7428d384",null),ti=ei.exports;d()(ei,{VBreadcrumbs:Zt["a"]});var ii={name:"Main",components:{ComponentHeader:ti}},ni=ii,ai=(i("599c"),i("f6c4")),si=Object(o["a"])(ni,Yt,Ht,!1,null,"3d9a3942",null),ri=si.exports;d()(si,{VAlert:vt["a"],VMain:ai["a"]}),n["a"].use(_["a"]);var li=[{path:"/",component:ri,meta:{title:"Прайс-листы",to:"pricelists"},children:[{path:"",component:Y,name:"pricelists"},{path:":id",component:pe,meta:{title:"Настройки магазина",to:"pricelist",replaceable:!0},children:[{path:"",component:kt,name:"pricelist"},{path:"categories",component:Nt,name:"pricelist.categories",meta:{title:"Категории"}},{path:"offers",component:gt,name:"pricelist.offers",meta:{title:"Предложения"}},{path:"generate",component:Gt,name:"pricelist.generate",meta:{title:"Выгрузка"}}]},{path:"*",redirect:"/"}]}],oi=new _["a"]({routes:li}),ci={namespaced:!0,state:{types:[]},getters:{findByType:function(e){return function(t){return e.types.find((function(e){return e.value===t}))}},typeText:function(e){return function(t){var i=t.type,n=e.types.find((function(e){return e.value===i}));return n?n.text:null}},selectableTypes:function(e){return e.types.filter((function(e){return!e.hidden}))},isSingle:function(e){return function(t){var i=t.type;return!!e.types.find((function(e){return e.single&&e.value===i}))}},isParent:function(e){return function(t){var i=t.type;return!!e.types.find((function(e){return e.value===i&&e.parent}))}},isUnique:function(e){return function(t){var i=t.type;return!!e.types.find((function(e){return e.unique&&e.value===i}))}},isSimpleString:function(){return function(e){var t=e.type;return 0===parseInt(t)}},isEmptyType:function(){return function(e){var t=e.type;return 20===parseInt(t)}},isRoot:function(){return function(e){var t=e.type;return 1===parseInt(t)}},isCategories:function(){return function(e){var t=e.type;return-1!==[4,14].indexOf(parseInt(t))}},isCurrencies:function(){return function(e){var t=e.type;return 3===parseInt(t)}},isOffers:function(){return function(e){var t=e.type;return-1!==[5,15].indexOf(parseInt(t))}},isShop:function(){return function(e){var t=e.type;return 2===parseInt(t)}},isPicture:function(){return function(e){var t=e.type;return 13===parseInt(t)}},isRawXml:function(){return function(e){var t=e.type;return 19===parseInt(t)}},availableTypes:function(e,t){return function(e,i){return t.selectableTypes.filter((function(t){var n=t.group||[];return Array.isArray(n)||(n=[n]),(!i||!i.fields.find((function(e){return t.unique&&e.type===t.value})))&&-1!==n.indexOf(e)}))}}},mutations:{setFieldTypes:function(e,t){e.types=t.results}},actions:{loadListTypes:function(e){var t=e.commit;F.post("Lists/Fields").then((function(e){var i=e.data;return t("setFieldTypes",i)}))}}},di={},ui={namespaced:!0,state:{marketplaces:[{text:"Яндекс Маркет",value:"yandex.market"}]},getters:{marketplaceText:function(e){return function(t){var i=e.marketplaces.find((function(e){return e.value===t}));return i?i.text:null}},availableFields:function(e){return function(t,i){var n=e.marketplaces.find((function(e){return e.value===i.type})),a=[];n&&n[t+"_fields"]&&(a=n[t+"_fields"]);var s=i.fields.find((function(e){return e.type===("offer"===t?6:2)}));return a.filter((function(e){return e.multiple||!i.fields.find((function(t){return t.name===e.value&&t.parent===s.id}))}))}}},mutations:{setMarketplaces:function(e,t){e.marketplaces=t.results}},actions:{loadList:function(e){var t=e.commit;F.post("Lists/Marketplaces").then((function(e){var i=e.data;return t("setMarketplaces",i)}))}}};n["a"].use(L["a"]);var pi=new L["a"].Store({modules:{field:ci,marketplace:ui,pricelist:di},state:{classKeys:[],operators:[{text:"Равно",sign:"=",value:"equals",select:!0},{text:"Не равно",sign:"!=",value:"not equals",select:!0},{text:"Больше чем",sign:">",value:"greater than"},{text:"Меньше чем",sign:"<",value:"less than"},{text:"Больше или равно",sign:">=",value:"greater than or equal to"},{text:"Меньше или равно",sign:"<=",value:"less than or equal to"},{text:"В строке",sign:"LIKE",value:"like"},{text:"Не в строке",sign:"NOT LIKE",value:"not like"},{text:"В списке",sign:"IN",value:"exists in",multiple:!0,select:!0},{text:"Не в списке",sign:"NOT IN",value:"not exists in",multiple:!0,select:!0},{text:"Null-значение",sign:"IS NULL",value:"is null",valueless:!0},{text:"Не null",sign:"IS NOT NULL",value:"is not null",valueless:!0}]},getters:{dataColumnsForGroup:function(e){return function(t){var i=[];return e.classKeys.forEach((function(e){t&&-1===e.groups.indexOf(t)||(e.header&&i.push({header:e.header}),e.fields&&i.push.apply(i,Object(Xe["a"])(e.fields)),i.push({divider:!0}))})),i}},operatorsList:function(e){return e.operators}},mutations:{setClassKeys:function(e,t){e.classKeys=t.results}},actions:{loadClassKeys:function(e){var t=e.commit;F.post("Lists/ClassKeys").then((function(e){var i=e.data;return t("setClassKeys",i)}))}}}),fi=i("8a39"),hi=i("688d"),vi="yandexmarket-app";window.onload=function(){var e=window.ym2Config||{};y.a.defaults.baseURL=e.apiUrl||"/assets/components/yandexmarket2/connector.php",y.a.defaults.headers.common["modAuth"]=e.modAuth,e.sentry&&fi["a"]({Vue:n["a"],dsn:e.sentry,integrations:[new hi["a"].BrowserTracing],tracesSampleRate:1}),n["a"].prototype.$xmlLoaded=e.xmlLoaded,n["a"].prototype.$isMODX3=e.isMODX3,n["a"].prototype.$t=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.lang[t]||t;if(Object.keys(i).length)for(var a in i)n=n.replace(new RegExp("{"+a+"}","g"),i[a]);return n},new n["a"]({vuetify:b,router:oi,store:pi,render:function(e){return e(f)}}).$mount("#".concat(vi))}},"599c":function(e,t,i){"use strict";i("8091")},"74ae":function(e,t,i){"use strict";i("b4ad")},7722:function(e,t,i){},8091:function(e,t,i){},"8b71":function(e,t,i){"use strict";i("265a")},9356:function(e,t,i){},b386:function(e,t,i){},b4ad:function(e,t,i){},b950:function(e,t,i){"use strict";i("d72b")},d72b:function(e,t,i){},dd54:function(e,t,i){"use strict";i("7722")},e393:function(e,t,i){},e48b:function(e,t,i){"use strict";i("1fec")},f1d2:function(e,t,i){}});